<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fetch /terms Demo</title>
</head>
<!-- Tailwind CSS CDN -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>

  <div class="min-h-screen bg-gray-50 flex flex-col items-center justify-start py-8">
    <h1 class="text-3xl font-bold mb-6 text-blue-700">Neurosynth Frontend by Peng Yuan June (R13H41017)</h1>
    <div class="w-full max-w-xl bg-white rounded-lg shadow p-6 mb-8">
      <div class="mb-4">
        <button id="btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded mr-2">Fetch All Terms</button>
      </div>
      <div class="mb-4 flex flex-col md:flex-row gap-2">
        <input id="termInput" type="text" placeholder="Enter term (e.g. amygdala)" class="border rounded px-3 py-2 flex-1" />
        <button id="btnTerm" class="bg-pink-500 hover:bg-pink-600 text-white font-semibold py-2 px-4 rounded">Lookup Term</button>
      </div>
      <div class="mb-4 flex flex-col md:flex-row gap-2">
        <input id="queryInput" type="text" placeholder="Enter query (e.g. amygdala not emotion)" class="border rounded px-3 py-2 flex-1" />
        <button id="btnQuery" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded">Logical Search</button>
      </div>
      <pre id="out" class="bg-gray-100 rounded p-4 text-sm overflow-x-auto">Loading...</pre>
    </div>
    <footer class="text-gray-500 text-xs mt-8">Powered by Tailwind CSS &amp; Neurosynth Backend</footer>
  </div>

  <script>
    // Utility to render styled lists
    function renderList(title, items) {
      return `<div class='mb-2'><span class='font-semibold'>${title}</span></div>` +
        `<ul class='list-disc pl-6 space-y-1'>` +
        items.map(item => `<li class='text-blue-700'>${item}</li>`).join('') +
        `</ul>`;
    }

    async function fetchTerms() {
      const out = document.getElementById('out');
      out.textContent = 'Requesting...';
      try {
        const resp = await fetch('https://mil.psy.ntu.edu.tw:5000/terms');
        let info = `HTTP ${resp.status} ${resp.statusText}\n`;
        const ct = resp.headers.get('content-type') || '';
        if (!resp.ok) {
          const text = await resp.text();
          out.innerHTML = `<span class='text-red-600'>${info}</span><br>${text}`;
          return;
        }
        if (ct.includes('application/json')) {
          const data = await resp.json();
          if (Array.isArray(data)) {
            out.innerHTML = renderList('Available Terms', data);
          } else {
            out.innerHTML = `<span class='text-green-700'>${info}</span><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
          }
        } else {
          const text = await resp.text();
          out.innerHTML = `<span class='text-green-700'>${info}</span><br>${text}`;
        }
      } catch (err) {
        document.getElementById('out').innerHTML =
          `<span class='text-red-600'>Error: ${err && err.message ? err.message : String(err)}</span><br><br>` +
          `<span class='text-gray-600'>Common causes:<br>1) CORS not allowed by the server<br>2) Opening this file via file:// instead of a local server<br>3) Network/server issues</span>`;
      }
    }

    async function fetchTermAssoc() {
      const out = document.getElementById('out');
      const term = document.getElementById('termInput').value.trim();
      if (!term) {
        out.innerHTML = `<span class='text-red-600'>Please enter a term.</span>`;
        return;
      }
      out.textContent = 'Requesting...';
      try {
        const resp = await fetch(`https://mil.psy.ntu.edu.tw:5000/terms/${encodeURIComponent(term)}`);
        let info = `HTTP ${resp.status} ${resp.statusText}\n`;
        const ct = resp.headers.get('content-type') || '';
        if (!resp.ok) {
          const text = await resp.text();
          out.innerHTML = `<span class='text-red-600'>${info}</span><br>${text}`;
          return;
        }
        if (ct.includes('application/json')) {
          const data = await resp.json();
          if (Array.isArray(data)) {
            out.innerHTML = renderList(`Terms associated with "${term}"`, data);
          } else {
            out.innerHTML = `<span class='text-green-700'>${info}</span><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
          }
        } else {
          const text = await resp.text();
          out.innerHTML = `<span class='text-green-700'>${info}</span><br>${text}`;
        }
      } catch (err) {
        out.innerHTML = `<span class='text-red-600'>Error: ${err && err.message ? err.message : String(err)}</span>`;
      }
    }

    async function fetchQueryStudies() {
      const out = document.getElementById('out');
      const query = document.getElementById('queryInput').value.trim();
      if (!query) {
        out.innerHTML = `<span class='text-red-600'>Please enter a query string.</span>`;
        return;
      }
      out.textContent = 'Requesting...';
      try {
        const resp = await fetch(`https://mil.psy.ntu.edu.tw:5000/query/${encodeURIComponent(query)}/studies`);
        let info = `HTTP ${resp.status} ${resp.statusText}\n`;
        const ct = resp.headers.get('content-type') || '';
        if (!resp.ok) {
          const text = await resp.text();
          out.innerHTML = `<span class='text-red-600'>${info}</span><br>${text}`;
          return;
        }
        if (ct.includes('application/json')) {
          const data = await resp.json();
          if (Array.isArray(data)) {
            out.innerHTML = renderList(`Studies for "${query}"`, data);
          } else {
            out.innerHTML = `<span class='text-green-700'>${info}</span><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
          }
        } else {
          const text = await resp.text();
          out.innerHTML = `<span class='text-green-700'>${info}</span><br>${text}`;
        }
      } catch (err) {
        out.innerHTML = `<span class='text-red-600'>Error: ${err && err.message ? err.message : String(err)}</span>`;
      }
    }

    document.getElementById('btn').addEventListener('click', fetchTerms);
    document.getElementById('btnTerm').addEventListener('click', fetchTermAssoc);
    document.getElementById('btnQuery').addEventListener('click', fetchQueryStudies);
    fetchTerms();
  </script>
</body>
</html>

